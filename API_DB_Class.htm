<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Nestor Documentation</title>
  <link rel="stylesheet" href="css/style.css">
  <script type="text/javascript" src="js/scripts.js"></script>
</head>
<body onload="includeHTML()">
  <div id="menu" menu-html="menu.html">

  </div>

  <div class="main">
   <!--INSERT CONTENT HERE-->

<h1>
    DB Class
</h1>
 <hr size="3" width="100%" align="center"/>
<p>
    The DB Class manages all interactions with the system database. The $db
    object is added to the global $vce object during site initiation, so make
    sure to call “global $vce” and then use then use $vce-&gt;db to call
    methods from the global $db object.
</p>
<p>
    Database errors are written to log.txt when VCE_DEBUG is set to true in
    your [<span class="italic">myinstall</span>]-config.php file.
</p>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935"  class="header_cell">
                    Properties
            </td>
        </tr>
    </tbody>
</table>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <th width="136" >

                    <strong>Name</strong>

            </th>
            <th width="143" >

                    <strong>Type</strong>

            </th>
            <th width="657" >

                    <strong>Description</strong>

            </th>
        </tr>
        <tr>
            <td width="136" >

                    $connection

            </td>
            <td width="143" >

                    object

            </td>
            <td width="657" >

                    set in the __construct method, holds a mysqli connection
                    object to communicate with the application database

            </td>
        </tr>
    </tbody>
</table>
<table border="1" cellspacing="0" cellpadding="0" id="methods">
    <tbody>
        <tr>
            <td width="935"  class="header_cell">
                    Methods
            </td>
        </tr>
    </tbody>
</table>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <th width="387" >

                    <strong>Name/Syntax</strong>

            </th>
            <th width="549" >

                    <strong>Description</strong>

            </th>
        </tr>
        <tr>
            <td width="387" >

                    <strong>
                        <a
                            href="#delete"
                        >
                            delete
                        </a>
                    </strong>
                    ($table, $where = array(), $limit = '')

            </td>
            <td width="549" >

                    Deletes rows from a specified table

            </td>
        </tr>
        <tr>
            <td width="387" >

                    <strong>
                        <a
                            href="#get_data_object"
                        >
                            get_data_object
                        </a>
                    </strong>
                    ($query, $object = true)

            </td>
            <td width="549" >

                    Runs the provided query and returns the dataset in a
                    readable format

            </td>
        </tr>
        <tr>
            <td width="387" >

                   <strong>
                    <a
                        href="#insert"
                    >
                        insert
                    </a></strong> 
                    ($table, $data = array())
                
            </td>
            <td width="549" >

                    Inserts data into database table

            </td>
        </tr>
        <tr>
            <td width="387" >

                    <strong>
                        <a
                            href="#query"
                        >
                            query
                        </a>
                    </strong>
                    ($query)

            </td>
            <td width="549" >

                    Runs the provided query and returns the results as a PHP
                    mysqli_result object.

            </td>
        </tr>
        <tr>
            <td width="387" >

                    <strong>
                        <a
                            href="#update"
                        >
                            update
                        </a>
                    </strong>
                    ($table, $data = array(),


                    $where = array(),


                    $limit = '',


                    $return_affected_rows = true)

            </td>
            <td width="549" >

                    Update rows in a specified table

            </td>
        </tr>
    </tbody>
</table>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935"  class="header_cell">
                    Method Details
            </td>
        </tr>
    </tbody>
</table>
<p><a href="#methods">Back to Top</a></p>
<table border="1" cellspacing="0" cellpadding="0" id="delete">
    <tbody>
        <tr>
            <td width="935"  class="method_name">Delete
                
            </td>
        </tr>
    </tbody>
</table>
<p>
    Deletes rows from a specified table.
</p>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935"  class="method_syntax">

                    delete($table, $where = array(), $limit = '')

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Parameters
</h3>
<table border="1" cellspacing="0" cellpadding="0" width="936">
    <tbody>
        <tr>
            <td width="180" >

                    $table

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    Name of database table from which you are deleting data

            </td>
        </tr>
        <tr>
            <td width="180" >

                    $where

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    WHERE statement for SQL query

            </td>
        </tr>
        <tr>
            <td width="180" >

                    $limit

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    LIMIT statement for SQL query

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Return
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="180" >

                    Boolean

            </td>
            <td width="755" >

                    Returns false if empty WHERE statement or database error

            </td>
        </tr>
        <tr>
            <td width="180" >

                    Object

            </td>
            <td width="755" >

                    Returns array of objects representing rows deleted (see
                    <a
                        href="#get_data_object"
                    >
                        Get Data Object
                    </a>
                    for format of returned data)

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Hooks
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935"  >

                    <span class="hook">db_delete</span> called after successful query execution

            </td>
        </tr>
    </tbody>
</table>
<h3>
</h3>
<h3>
    Example
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935"  class="codified">

                    $table = 'email_data';<br>


                    $where = array( 'user_id' =&gt; 4241, 'email' =&gt;
                    'email@address.com' );<br>


                    $vce-&gt;db-&gt;delete($table , $where, 1 );<br>

            </td>
        </tr>
    </tbody>
</table>
<table border="1" cellspacing="0" cellpadding="0" id="get_data_object">
    <tbody>
        <tr>
            <td width="935" class="method_name">Get Data Object
                
            </td>
        </tr>
    </tbody>
</table>
<p>

    Runs the provided query and returns the dataset in a readable format. There
    is also a
    <a
        href="#query"
    >
        query method
    </a>
    that returns the native PHP mysqli_result object, which is a bit less easy
    to traverse.
</p>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935"  class="method_syntax">

                    get_data_object($query, $object = true)

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Parameters
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="180" >

                    $query

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    The query to be run on the database

            </td>
        </tr>
        <tr>
            <td width="180" >

                    $object

            </td>
            <td width="162" >

                    Boolean

            </td>
            <td width="594" >

                    Determines whether data is returned as an array of objects
                    or multi-dimensional array, is set to true by default to
                    return objects

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Return
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="198" >

                    Array of objects

            </td>
            <td width="738" >

                    When $object = true (set by default), the data is returned
                    as an array of objects, with each object representing a
                    record in the dataset.

            </td>
        </tr>
        <tr>
            <td width="198" >

                    Multi-dimensional array

            </td>
            <td width="738" >

                    When $object = false, the data is returned as a
                    multi-dimensional array.

            </td>
        </tr>
    </tbody>
</table>
<p>
    
</p>
<h3>
    Example
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" ><h4>$object = true, results returned as an array of objects</h4></td></tr>
        </tr>
        <tr>
            <td class="codified">
                    $myData = $vce-&gt;db-&gt;get_data_object('SELECT * FROM
                    vce-site-properties');<br>


                    // output data of each row<br><br>


                    &nbsp;&nbsp;foreach (myData as $row) {<br>


                        &nbsp;&nbsp;echo '&lt;br&gt;';<br>


                        &nbsp;&nbsp;echo $row-&gt;name;<br>


                    }

            </td>
        </tr>
        <tr>
            <td >
                <div><h4>$object = false, results returned as a multi-dimensional
                        array</h4>
                </div>
            </td>
        </tr>
        <tr>
            <td  class="codified">



                    $myData = $vce-&gt;db-&gt;get_data_object('SELECT * FROM
                    vce-site-properties', false);<br>


                    // output data of each row<br><br>


                    foreach (myData as $row) {<br>

                        &nbsp;&nbsp;echo $row['name'];<br>
                        &nbsp;&nbsp;echo '&lt;br&gt;';<br>
                    }

            </td>
        </tr>
    </tbody>
</table>
<p><a href="#methods">Back to Top</a></p>
<table border="1" cellspacing="0" cellpadding="0" id="insert">
    <tbody>
        <tr>
            <td width="935" class="method_name">Insert                
            </td>
        </tr>
    </tbody>
</table>
<p>
    Inserts data into database table. This method handles most types of
    insertion into a single table. It determines if it is a single row or
    multiple rows being inserted and processes the call as needed.
</p>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" class="method_syntax">

                    insert($table, $data = array())

            </td>
        </tr>
    </tbody>
</table>
<h3>
</h3>
<h3>
    Parameters
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="180" >

                    $table

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    The table into which you’ll insert data

            </td>
        </tr>
        <tr>
            <td width="180" >

                    $data

            </td>
            <td width="162" >

                    Array

            </td>
            <td width="594" >

                    An array of data to insert. This can be a single row array
                    or multidimensional array.

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Return
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="198" >

                    Boolean

            </td>
            <td width="738" >

                    Returns false if database error

            </td>
        </tr>
        <tr>
            <td width="198" >

                    Int

            </td>
            <td width="738" >

                    Returns the auto-incremented ID generated for the last row
                    inserted if successful insert

            </td>
        </tr>
    </tbody>
</table>

<h3>
    Hooks
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" >

                   <span class="hook">db_insert</span> called after insert query is executed

            </td>
        </tr>
    </tbody>
</table>


<h3>
    Example
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" ><h4>for single row of data</h4></td>
            </tr>
        <tr>
            <td class="codified">

                    $data = array(<br>


                    &nbsp;&nbsp;'name' =&gt; 'Sunil',<br>


                    &nbsp;&nbsp;'email' =&gt; 'sunil@email.com',<br>


                    &nbsp;&nbsp;'active' =&gt; 1<br>


                    );

            </td>
        </tr>
        <tr>
            <td><h4>for multi-dimensional data array</h4></td>
        </tr>
        <tr>
            <td class="codified">
                    $data = array(<br><br>

                        &nbsp;&nbsp;array(<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'name'=&gt;'Consuela',<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'email'=&gt;'consuela@email.com',<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'state'=&gt;'WA'),<br><br>


                        &nbsp;&nbsp;array(<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'name'=&gt;'Vincent', <br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'email'=&gt;'vinnie@email.com',<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'state'=&gt;'MI'),<br><br>


                        &nbsp;&nbsp;array(<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'name'=&gt;'Ngoc Huyen',<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'email'=&gt;'ngoc_huyen@email.com',<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;'state'=&gt;'CA')<br><br>


                    );<br><br>


                    $table = 'students';<br>


                    $last_inputID = $vce-&gt;db-&gt;insert($table, $data);<br><br>


                    //output the last id generated<br><br>


                    echo $last_inputID;<br>

            </td>
        </tr>
    </tbody>
</table>

<p><a href="#methods">Back to Top</a></p>
<table border="1" cellspacing="0" cellpadding="0" id="query">
    <tbody>
        <tr>
            <td width="935" class="method_name">Query
                
            </td>
        </tr>
    </tbody>
</table>
<p>
    Runs the provided query and returns the results as a PHP mysqli_result
    object.
</p>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" class="method_syntax">

                    query($query)

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Parameters
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="180" >

                    $query

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    The query to be run on the database

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Return
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="180" >

                    Boolean

            </td>
            <td width="755" >

                    Returns false if database call returns an error

            </td>
        </tr>
        <tr>
            <td width="180" >

                    Object

            </td>
            <td width="755" >

                    Returns mysqli_results object if successful query execution

            </td>
        </tr>
    </tbody>
</table>

<h3>
    Example
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" class="codified">

                    $sql = "SELECT * from vce_datalists";<br>


                    $result = $vce-&gt;db-&gt;query($sql);<br>


                    $datalist_ids="";<br><br>


                    if ($result-&gt;num_rows &gt; 0) {<br>


                    &nbsp;&nbsp;while($row = $result-&gt;fetch_assoc()) {<br>


                        &nbsp;&nbsp;&nbsp;&nbsp;$datalist_ids .= "id: " . $row["datalist_id"]. " - Datalist
                    ID: " .


                    "&lt;br&gt;";<br>


                    &nbsp;&nbsp;}<br><br>


                    } else {
                        <br>

                        &nbsp;&nbsp;$datalist_ids .= "0 results";<br>


                    }

            </td>
        </tr>
    </tbody>
</table>
<p><a href="#methods">Back to Top</a></p>
<table border="1" cellspacing="0" cellpadding="0" id="update">
    <tbody>
        <tr>
            <td width="935" class="method_name">Update
            </td>
        </tr>
    </tbody>
</table>
<p>
    Update data in specified table
</p>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" class="method_syntax">

                    update($table, $data = array(),


                    $where = array(),


                    $limit = '',


                    $return_affected_rows = true)

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Parameters
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="180" >

                    $table

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    Name of database table into which you are inserting data

            </td>
        </tr>
        <tr>
            <td width="180" >

                    $data

            </td>
            <td width="162" >

                    Array

            </td>
            <td width="594" >

                    Data to insert

            </td>
        </tr>
        <tr>
            <td width="180" >

                    $where

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    WHERE statement for SQL query

            </td>
        </tr>
        <tr>
            <td width="180" >

                    $limit

            </td>
            <td width="162" >

                    String

            </td>
            <td width="594" >

                    LIMIT statement for SQL query

            </td>
        </tr>
        <tr>
            <td width="180" >

                    $return_affected_rows

            </td>
            <td width="162" >

                    Boolean

            </td>
            <td width="594" >

                    Determines whether the number of affected rows is returned,
                    set true by default

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Return
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="180" >

                    Boolean

            </td>
            <td width="755" >

                    Return false if there is a database error, or no rows
                    affected

            </td>
        </tr>
        <tr>
            <td width="180" >

                    Boolean

            </td>
            <td width="755" >

                    Return true if rows updated but $return_affected_rows set
                    to false

            </td>
        </tr>
        <tr>
            <td width="180" >

                    int

            </td>
            <td width="755" >

                    Return amount of affected rows if $return_affected_rows set
                    to true

            </td>
        </tr>
    </tbody>
</table>

<h3>
    Hooks
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" >

                    <span class="hook">db_update</span> hook called after update query executed.

            </td>
        </tr>
    </tbody>
</table>
<h3>
    Example
</h3>
<table border="1" cellspacing="0" cellpadding="0">
    <tbody>
        <tr>
            <td width="935" class="codified">

                    $data = array( 'name' =&gt; 'Nora Bennett',


                    'email' =&gt; 'nora.bennett@email.com' );<br>


                    $update_where = array( 'user_id' =&gt; 44, 'name' =&gt;
                    'Bennett' );<br>


                    $num_rows = $vce-&gt;db-&gt;update( 'users_table', $update,
                    $update_where, 1 );<br>

            </td>
        </tr>
    </tbody>
</table>


<p><a href="#methods">Back to Top</a></p>


  </div><!--end main div-->

 
</body>
</html>
